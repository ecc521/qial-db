<!DOCTYPE html>
<html>
	<bead>
	</head>
	<body>
		<link rel="stylesheet" href="index.css">

		<h1>qial-db</h1>
		<h2>Quantitative Imaging and Analysis Laboratories</h2>

		<p>This tool generates a salt/hash pair to be added to the <a href="https://docs.google.com/document/d/1h0dFgl7Q7SaK8jOLzf0H1hqS7asZnhPsEMAEQTMstpQ/edit#bookmark=id.27diyy1g0f04" target="_blank">Credential Combo Storage</a>. </p>
		<input id="password" type="password" placeholder="Enter New Password">
		<button id="toggle">Show Password</button>
		<button id="generate">Generate Salt/Hash Password Combo</button>
		<div id="permissions">
			<h2>Password Permissons: </h2>
		</div>
		<p id="result"></p>

		<script>

		let permissionElem = document.getElementById("permissions")
		let permissions = ["Upload", "Rename", "Delete"]
		let defaults = [true, true, false]

		permissions = permissions.map((permission, index) => {
			let checkbox = document.createElement("input")
			checkbox.type = "checkbox"
			checkbox.checked = defaults[index]

			let label = document.createElement("label")
			label.innerHTML = permissions[index]

			permissionElem.appendChild(label)
			permissionElem.appendChild(checkbox)

			permissionElem.appendChild(document.createElement("br"))

			return checkbox
		})


		let passwordInput = document.getElementById("password")
		let toggle = document.getElementById("toggle")
		let generate = document.getElementById("generate")
		let result = document.getElementById("result")

			passwordInput.addEventListener("input", function() {
				result.innerHTML = "" //Clear result
			})

			toggle.addEventListener("click", function() {
				if (passwordInput.type === "password") {
					passwordInput.type = "text"
					toggle.innerHTML = "Hide Password"
				}
				else {
					passwordInput.type = "password"
					toggle.innerHTML = "Show Password"
				}
			})

			generate.addEventListener("click", async function() {
				result.innerHTML = "Generating...."
				let url = "node/auth/generateentry"
				if (window.location.host.startsWith("127.0.0.1")) {
					url = "http://" + window.location.hostname + ":3000" + "/auth/generateentry" //Local dev doesn't go through apache.
				}

				let request = await fetch(url, {
					method: "POST",
					headers: {
						"qial-password": passwordInput.value,
					}
				})
				let response = await request.text()
				result.innerHTML = response
				permissions.forEach((item, i) => {
					if (item.checked === true) {result.innerHTML += "y"}
					else if (item.checked === false) {result.innerHTML += "n"}
				});

			})
		</script>

		<style>
		* {
			text-align: center;
		}
		</style>
	</body>
</html>
